<html>
    <head>
        <title>D3 Test</title>
        <script type="text/javascript" src="d3.v2.js"></script>
        <style type="text/css">
	  .axis path,
	  .axis line {
	      fill: none;
	      stroke: black;
	      shape-rendering: crispEdges;
	  }
	  
	  .axis text {
	      font-family: sans-serif;
	      font-size: 11px;
	  }

	  .legend {
	      width: 1000;
	      height: 20;
	      text-align: center;
	  }

	  .legend text {
	  }
	</style>
    </head>
    <body>
      <script type="text/javascript">
var w = 1000;
var h = 500;
var barPadding = 1;
var padding = 30;
var colorMap = {
    "India": "#1f77b4",
    "Pakistan": "#637939"
};
var svg = d3.select("body")
    .append("svg")
    .attr("width", w)
    .attr("height", h);

function bowlAv(d) {
    return Number(d.performance.BowlAv);
};

function wickets(d) {
    return Number(d.performance.W);
};

function bestBowling(d) {
    return Number(d.performance.BB.split("/")[0]);
};

function team(d) {
    return d.country;
};

function capitalize(w) {
    return w.replace(w.charAt(0), w.charAt(0).toUpperCase());
};

function humanize(str) {
    return str.split(" ").map(function(w){
	if(w == "in") {
	    return w;
	} else {
	    return capitalize(w);
	}
    }).join(" ");
};

function prettyData(d) {
    return (d.name + ", \n"
	    + humanize(d.series) + ", \n"
	    + "Bowling Average: " + bowlAv(d) + ", \n"
	    + "Wickets: " + wickets(d) + ", \n"
	    + "Best Bowling: " + d.performance.BB);
};

function writeLegend(d) {
    clearLegend(d);
    d3.select(".legend")
	.append("text")
	.text(prettyData(d));
};

function clearLegend(d) {
    d3.select(".legend")
	.select("text")
	.text("")
	.remove();
};

d3.json("../data/debuts.json", function(dataset) {
    var xScale = d3.scale.linear()
	.domain([0, d3.max(dataset, function(d) {return bowlAv(d);})])
	.range([2 * padding, w - padding]);

    var yScale = d3.scale.linear()
	.domain([0, d3.max(dataset, function(d) {return wickets(d);})])
	.range([h - 2 * padding, padding]);

    var radiusScale = d3.scale.linear()
	.domain([0, d3.max(dataset, function(d) {return bestBowling(d);})])
	.range([0, 20]);

    var circles = svg.append("g")
	.selectAll("circle")
	.data(dataset)
	.enter()
	.append("circle")
	.attr("cx", function(d, i) {return xScale(bowlAv(d));})
	.attr("cy", function(d) {return yScale(wickets(d));})
	.attr("r", function(d) {return radiusScale((bestBowling(d)));})
	.attr("fill", function(d) {
	    return colorMap[team(d)];
	})
	.attr("stroke", "white")
	.attr("opacity", 0.6)
	.on("mouseover", function(d){
	    d3.select(this)
		.attr("r", function(d) {
		    return radiusScale(bestBowling(d)) + 5;
		})
		.attr("opacity", "1");
	    writeLegend(d);
	})
	.on("mouseout", function(d){
	    d3.select(this)
		.attr("r", function(d) {return radiusScale(bestBowling(d));})
		.attr("opacity", 0.6);
	    clearLegend();
	})
	.sort(function(a, b) {
	    return bestBowling(b) -  bestBowling(a);
	});

    circles.append("title")
	.text(function(d) {return prettyData(d);});
    
    var xAxis = d3.svg.axis()
	.scale(xScale)
	.ticks(20)
	.orient("bottom");

    svg.append("g")
	.attr("class", "axis")
	.attr("transform", "translate(0," + (h - 2 * padding) + ")")
	.call(xAxis);

    svg.append("text")
    	.text("Bowling Average")
	.attr("x", (w - 2 * padding)/2)
	.attr("y", h - padding);

    var yAxis = d3.svg.axis()
	.scale(yScale)
	.ticks(10)
	.orient("left");

    svg.append("g")
    	.attr("class", "axis")
	.attr("transform", "translate(" +  2 * padding + ", 0)")
    	.call(yAxis);
    
    var yLabel = svg.append("g");
    yLabel.append("text")
    	.text("Wickets")
	.attr("text-anchor", "middle");
    yLabel.attr("transform", "translate(" + padding/2 + "," +  (h - padding)/2 +") rotate(270)");
});
      </script>
      <div class="legend">
      </div>
    </body>
</html>
